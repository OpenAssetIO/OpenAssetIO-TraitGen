{%- if copyrightOwner -%}
// SPDX-License-Identifier: {{ spdxLicenseIdentifier }}
// Copyright {{ copyrightDate }} {{ copyrightOwner }}
{%- endif %}
// WARNING: This file is auto-generated by openassetio-traitgen, do not edit.

#pragma once

#include <memory>

#include <openassetio/trait/TraitsData.hpp>
#include <openassetio/trait/collection.hpp>

namespace openassetio_abi = openassetio::{{ openassetio_abi_version }};

{%- for header_path_tokens in (all_trait_header_path_tokens | selectattr("package", "!=", package.id) | sort) -%}
{%- if loop.first %}
{% endif %}
#include <{{ header_path_tokens.package | to_cpp_namespace_name }}/traits/{{ header_path_tokens.namespace | to_cpp_namespace_name }}/{{ header_path_tokens.name | to_cpp_class_name }}Trait.hpp>
{%- endfor -%}

{%- for header_path_tokens in (all_trait_header_path_tokens | selectattr("package", "==", package.id) | sort) -%}
{%- if loop.first %}
{% endif %}
#include "../../traits/{{ header_path_tokens.namespace | to_cpp_namespace_name }}/{{ header_path_tokens.name | to_cpp_class_name }}Trait.hpp"
{%- endfor -%}

{%- macro trait_type(trait) -%}
{%- if trait.package == package.id -%}
traits::{{trait.namespace | to_cpp_namespace_name }}::{{trait.name | to_cpp_class_name }}Trait_v{{ trait.version }}
{%- else -%}
{{ trait.package | to_cpp_namespace_name }}::traits::{{trait.namespace | to_cpp_namespace_name }}::{{ trait.name | to_cpp_class_name }}Trait_v{{ trait.version }}
{%- endif -%}
{%- endmacro %}

namespace {{ package.id | to_cpp_namespace_name }} {
inline namespace {{ traitgen_abi_version }} {
namespace specifications::{{ namespace.id | to_cpp_namespace_name }} {

{%- for specification in versions %}
{% set classname = specification.id | to_cpp_class_name ~ 'Specification_v' ~ specification.version -%}
/**
 * {{ specification.description | wordwrap(69, wrapstring="\n* ") | indent(1) }}
{%- if specification.usage %}
 * Usage: {{ specification.usage | join(', ') }}
{%- endif %}
{%- if specification.deprecated %}
 *
 * @deprecated This specification is flagged for future removal.
{%- endif %}
 */
class
{%- if specification.deprecated %}
[[deprecated("The '{{ namespace.id | to_cpp_namespace_name }}.{{ specification.id }}' specification of the '{{ package.id | to_cpp_namespace_name }}' package is deprecated.")]]
{% endif %} {{ classname }} {
public:
  inline static const openassetio_abi::trait::TraitSet kTraitSet{
    {%- for trait in specification.trait_set %}
    // '{{ trait.id }}'
    {{ trait_type(trait) }}::kId,
    {%- endfor %}
  };

  /**
   * Returns a new instance of the Specification, holding a new
   * TraitsData instance, imbued with the specification's traits.
   */
  static {{ classname }} create() {
    return {{ classname }}{
      openassetio_abi::trait::TraitsData::make(kTraitSet)};
  }

  /**
   * Constructs the specification as a view on the supplied shared
   * TraitsData instance.
   *
   * @warning Specifications are always a view on the supplied data,
   * which is held by reference. Any changes made to the data will be
   * visible to any other specifications or traits that wrap the same
   * TraitsData instance.
   */
  explicit {{ classname }}(openassetio_abi::trait::TraitsDataPtr traitsData)
    : traitsData_{std::move(traitsData)}
  {}

  /**
   * Returns the underlying (shared) TraitsData instance held by this
   * specification.
   */
  [[nodiscard]] const openassetio_abi::trait::TraitsDataPtr& traitsData() const {
    return traitsData_;
  }

{% for trait in specification.trait_set %}
  /**
   * Returns the view for the '{{ trait.id }}'
   * trait wrapped around the data held in this instance.
   */
  [[nodiscard]] {{ trait_type(trait) }} {{ trait.unique_name_parts | to_cpp_trait_accessor_name }}Trait() const {
    return {{ trait_type(trait) }}{traitsData_};
  }
{% endfor %}

private:
  openassetio_abi::trait::TraitsDataPtr traitsData_;
};

{% endfor %}
{%- set specification = versions[0] -%}
{%- set base_classname = specification.id | to_cpp_class_name ~ 'Specification' %}
/**
 * {{ specification.description | wordwrap(69, wrapstring="\n* ") | indent(1) }}
{%- if specification.usage %}
 * Usage: {{ specification.usage | join(', ') }}
{%- endif %}
 *
 * @deprecated Unversioned specification view classes are deprecated,
 * please use {{ base_classname }}_v1 explicitly.
 */
class
[[deprecated("Unversioned specification view classes are deprecated, please use {{ base_classname }}_v1 explicitly.")]]
{{ base_classname }} : public {{ base_classname }}_v1 {
public:
  using {{ base_classname }}_v1::{{ base_classname }}_v1;

 /**
  * Returns a new instance of the Specification, holding a new
  * TraitsData instance, imbued with the specification's traits.
  */
  static {{ base_classname }} create() {
    return {{ base_classname }}{
      openassetio_abi::trait::TraitsData::make(kTraitSet)};
  }
};
}  // namespace specifications::{{ namespace.id | to_cpp_namespace_name }}
}  // namespace {{ traitgen_abi_version }}
}  // namespace {{ package.id | to_cpp_namespace_name }}

